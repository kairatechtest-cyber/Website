<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Weather Widget</title>
<style>
:root {
  --day-bg: linear-gradient(180deg,#6ec6ff 0%,#1e88e5 100%);
  --night-bg: linear-gradient(180deg,#0f2027 0%,#203a43 60%,#2c5364 100%);
  --glass: rgba(255,255,255,0.2);
  --white: #fff;
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",sans-serif;}
body{background:transparent;overflow:hidden}

/* ---------- MINI CARD ---------- */
.weather-mini{
  position:fixed;
  bottom:25px;right:25px;
  background:var(--day-bg);
  color:var(--white);
  border-radius:15px;
  box-shadow:0 6px 20px rgba(0,0,0,0.25);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 16px;
  width:200px;height:90px;
  cursor:pointer;
  transition:.3s;
  z-index:9999;
}
.weather-mini:hover{transform:translateY(-3px);}
.weather-mini .info{display:flex;flex-direction:column;gap:2px;}
.weather-mini .city{font-size:13px;font-weight:500;display:flex;align-items:center;gap:4px;}
.weather-mini .temp{font-size:26px;font-weight:700;}
.weather-mini .cond{font-size:12px;opacity:.9;}
.weather-mini img{width:42px;height:42px;}

/* ---------- FULL PANEL ---------- */
.weather-full {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border-radius: 22px;
  background: var(--day-bg);
  color: #fff;
  display: none;
  flex-direction: column;
  box-shadow: 0 10px 40px rgba(0, 0, 0, .3);
  padding: 18px;
  overflow-y: auto;
  z-index: 10000;
  transition: all 0.3s ease;
}
.weather-full::-webkit-scrollbar {
  width: 6px;
}
.weather-full::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.4);
  border-radius: 10px;
}

.close-btn{
  position:absolute;top:12px;right:15px;
  background:rgba(0,0,0,0.3);
  width:28px;height:28px;
  display:flex;align-items:center;justify-content:center;
  border-radius:50%;cursor:pointer;
}
.close-btn:hover{background:rgba(255,255,255,0.3);}
.header{text-align:center;margin-top:30px;}
.header h2{font-size:18px;font-weight:600;margin-bottom:4px;}
.header .temp{font-size:40px;font-weight:700;}
.header .cond{font-size:14px;opacity:.9;}
.header img{width:70px;margin:10px auto;display:block;}

.forecast{
  display:flex;gap:10px;overflow-x:auto;
  margin:10px 0;padding-bottom:6px;
}
.forecast-day{
  min-width:70px;text-align:center;
  background:rgba(255,255,255,0.15);
  border-radius:10px;padding:8px;
  backdrop-filter:blur(6px);
}
.forecast-day img{width:34px;}

.tabs{display:flex;justify-content:space-around;margin:10px 0;}
.tab{
  flex:1;text-align:center;padding:10px;border-radius:12px;
  background:rgba(255,255,255,.1);
  cursor:pointer;transition:.2s;
}
.tab.active{background:rgba(255,255,255,.3);}
.tab:hover{background:rgba(255,255,255,.25);}

.tab-content{display:none;background:rgba(255,255,255,.15);border-radius:12px;padding:10px 15px;}
.tab-content.active{display:block;}
.tab-content h3{margin-bottom:8px;font-size:15px;}
.tab-content ul{list-style:none;font-size:13px;line-height:1.7;}
.tab-content ul li{margin-bottom:3px;}
</style>
</head>

<body>
<!-- MINI CARD -->
<div class="weather-mini" id="weatherMini" onclick="expandWeather()">
  <div class="info">
    <div class="city" id="miniCity">Loading...</div>
    <div class="temp" id="miniTemp">--Â°C</div>
    <div class="cond" id="miniCond">---</div>
  </div>
  <img id="miniIcon" src="" alt="">
</div>

<!-- FULL PANEL -->
<div class="weather-full" id="weatherFull">
  <div class="close-btn" onclick="collapseWeather()">âœ•</div>
  <div class="header">
    <h2 id="fullCity">--</h2>
    <div class="temp" id="fullTemp">--Â°C</div>
    <div class="cond" id="fullCond">---</div>
    <img id="fullIcon" src="" alt="">
  </div>

  <div class="forecast" id="forecast"></div>

  <div class="tabs">
    <div class="tab active" data-tab="astro">ğŸŒ…</div>
    <div class="tab" data-tab="marine">ğŸŒŠ</div>
    <div class="tab" data-tab="air">ğŸƒ</div>
    <div class="tab" data-tab="alerts">âš ï¸</div>
  </div>

  <div id="astro" class="tab-content active">
    <h3>Astronomy & Solar</h3>
    <ul id="astroData"></ul>
  </div>
  <div id="marine" class="tab-content">
    <h3>Marine & Tide</h3>
    <ul id="marineData"></ul>
  </div>
  <div id="air" class="tab-content">
    <h3>Pollen & Air Quality</h3>
    <ul id="airData"></ul>
  </div>
  <div id="alerts" class="tab-content">
    <h3>Alerts & Forecast</h3>
    <ul id="alertsData"></ul>
  </div>
</div>

<script>
const apiKey = "63586511f13147bbab964352251311";

// ğŸŒ Get user location
async function getLocation(){
  return new Promise((resolve)=>{
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(
        pos=>resolve(`${pos.coords.latitude},${pos.coords.longitude}`),
        ()=>resolve("auto:ip")
      );
    }else resolve("auto:ip");
  });
}

// ğŸŒ¦ Fetch Weather Data
async function loadWeather(){
  const loc=await getLocation();
  const url=`https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${loc}&days=5&aqi=yes&alerts=yes`;
  const res=await fetch(url);
  const data=await res.json();

  // MINI
  document.getElementById("miniCity").textContent=data.location.name;
  document.getElementById("miniTemp").textContent=`${data.current.temp_c.toFixed(1)}Â°C`;
  document.getElementById("miniCond").textContent=data.current.condition.text;
  document.getElementById("miniIcon").src="https:"+data.current.condition.icon;

  const isDay=data.current.is_day===1;
  document.getElementById("weatherMini").style.background=isDay?"var(--day-bg)":"var(--night-bg)";
  document.getElementById("weatherFull").style.background=isDay?"var(--day-bg)":"var(--night-bg)";

  // FULL
  document.getElementById("fullCity").textContent=`${data.location.name}, ${data.location.country}`;
  document.getElementById("fullTemp").textContent=`${data.current.temp_c.toFixed(1)}Â°C`;
  document.getElementById("fullCond").textContent=data.current.condition.text;
  document.getElementById("fullIcon").src="https:"+data.current.condition.icon;

  // Forecast
  const f=data.forecast.forecastday.map(d=>`
    <div class='forecast-day'>
      <div>${new Date(d.date).toLocaleDateString('en-US',{weekday:'short'})}</div>
      <img src="https:${d.day.condition.icon}" alt="">
      <div>${d.day.avgtemp_c.toFixed(1)}Â°C</div>
    </div>`).join('');
  document.getElementById("forecast").innerHTML=f;

  // Tabs
  const astro=data.forecast.forecastday[0].astro;
  document.getElementById("astroData").innerHTML=`
    <li>ğŸŒ… Sunrise: ${astro.sunrise}</li>
    <li>ğŸŒ‡ Sunset: ${astro.sunset}</li>
    <li>ğŸŒ™ Moon Phase: ${astro.moon_phase}</li>
  `;
  document.getElementById("marineData").innerHTML=`
    <li>ğŸ’§ Humidity: ${data.current.humidity}%</li>
    <li>ğŸ’¨ Wind: ${data.current.wind_kph} km/h</li>
    <li>ğŸ“ˆ Pressure: ${data.current.pressure_mb} mb</li>
  `;
  document.getElementById("airData").innerHTML=`
    <li>ğŸŒ¿ Air Quality Index: ${data.current.air_quality["us-epa-index"] || "N/A"}</li>
    <li>ğŸƒ Pollen Data: Available in Pro+ Plan</li>
  `;
  const alerts=data.alerts.alert.length?data.alerts.alert.map(a=>`<li>âš ï¸ ${a.headline}</li>`).join(""):"<li>No active alerts</li>";
  document.getElementById("alertsData").innerHTML=alerts;
}

// ğŸŒˆ Expand/Collapse
function expandWeather(){
  document.getElementById("weatherFull").style.display="flex";
  document.getElementById("weatherMini").style.opacity="0.5";
  window.parent.postMessage({ type: "weatherExpand" }, "*");
}

function collapseWeather(){
  document.getElementById("weatherFull").style.display="none";
  document.getElementById("weatherMini").style.opacity="1";
  window.parent.postMessage({ type: "weatherCollapse" }, "*");
}



// ğŸ” Tabs
document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.add("active");
  });
});

// Load on start + refresh every 60s
loadWeather();
setInterval(loadWeather,60000);
</script>
</body>
</html>
